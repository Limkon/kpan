- 支持[alwaysdata](https://www.alwaysdata.com/en/)空间一键安装，SSH登陆后执行以下命令，安装完成后在alwaysdata空间设置中找到Command*添加node server.js
     ```bash
     bash <(curl -fsSL https://raw.githubusercontent.com/Limkon/Netnope/master/setup.sh)
     ```

# 记事本 (Node.js 原生实现)

这是一个完全使用 Node.js 内置模块构建的简单记事本Web应用程序，旨在演示如何在不依赖任何第三方NPM包的情况下，从头开始实现一个包含用户认证、数据存储、富文本编辑、文件上传和搜索等功能的Web应用。

## 主要功能

* **用户系统**:
    * 普通用户注册与登录。
    * 密码使用加盐哈希 (PBKDF2) 进行加密存储。
    * 普通用户可以修改自己的密码（需要验证当前密码）。
    * 管理员 (预设账户 `admin`/`admin`)。
    * 管理员可以创建、删除（包括其他管理员）和重设任何用户的密码。
    * 系统至少保留一名管理员，防止所有管理员被删除。
* **记事管理**:
    * 创建、查看、编辑和删除记事。
    * 记事内容支持富文本编辑（加粗、斜体、下划线、列表、字体、字号、颜色、插入本地图片、链接等）。
    * 每条记事可以附加一个文件（类型不限，文件名支持中文）。
    * 附件会随记事一同存储和删除。
* **数据存储**:
    * 所有用户数据和记事数据均以 JSON 格式存储在服务器本地的 `data` 目录中。
    * 上传的附件存储在服务器本地的 `uploads` 目录中，按用户ID分子目录存放。
* **访问控制**:
    * 用户登录后才能进行记事操作。
    * 管理员可以查看所有用户的记事列表。
    * 普通用户只能管理自己的记事。
    * **匿名访问控制**：
        * 管理员可以通过创建或删除一个名为 `anyone` 且角色为 `anonymous` 的特殊用户来启用或禁用匿名只读访问。
        * 当匿名访问启用时，未登录用户可以浏览所有记事（但不能进行任何修改操作）。
* **搜索功能**:
    * 用户可以在记事列表页面根据关键字搜索记事。
    * 搜索会匹配记事的标题和内容（内容会先去除HTML标签再进行匹配）。
    * 搜索结果会高亮显示匹配的关键字。
* **技术特点**:
    * 完全使用 Node.js 内置模块 (`http`, `fs`, `path`, `url`, `querystring`, `crypto`)。
    * 无任何第三方NPM依赖。
    * 手动实现HTTP请求处理、路由、会话管理（基于Cookie）、表单数据解析（包括`multipart/form-data`）。

## 警告

**此项目主要用于学习和技术演示目的。在生产环境中使用前，需要进行彻底的安全审计和加固。**

主要原因包括但不限于：
* **安全性**：虽然密码已加密，但整体安全措施（如XSS内容过滤、CSRF防护、更健壮的会话管理、HTTP头部安全配置、错误处理细节等）仍显不足。
* **健壮性**：手动实现的底层逻辑相比成熟框架，在错误处理和边界情况的覆盖上可能不够完善。
* **性能考量**：使用同步文件系统操作读写JSON文件作为数据库，在高并发场景下会遇到性能瓶颈。
* **富文本安全性**：从富文本编辑器获取的HTML内容直接存储和渲染，存在XSS风险，实际应用中需要严格的HTML清理和过滤。
* **Base64图片**：富文本中插入本地图片采用Base64编码嵌入HTML，大图片会导致记事内容体积剧增，影响性能。

## 如何运行

1.  **环境准备**:
    * 确保您的系统中已安装 Node.js (建议使用最新的LTS版本)。
2.  **获取代码**:
    * 将项目所有提供的代码文件和文件夹（`server.js`, `router.js`, `auth.js`, `userController.js`, `noteController.js`, `storage.js`, `responseUtils.js`, `public/` 目录及其内容, `package.json`）放置在您本地文件系统的一个新建目录中（例如 `notepad-app`）。
3.  **目录结构确认**:
    确保您的项目根目录下有以下结构：
    ```
    notepad-app/
    ├── server.js
    ├── router.js
    ├── auth.js
    ├── userController.js
    ├── noteController.js
    ├── storage.js
    ├── responseUtils.js
    ├── public/
    │   ├── css/
    │   │   └── style.css
    │   ├── js/
    │   │   └── main.js
    │   ├── login.html
    │   ├── register.html
    │   ├── change-password.html
    │   ├── index.html
    │   ├── note.html
    │   ├── view-note.html
    │   └── admin.html
    ├── package.json
    └── README.md 
    ```
    (首次运行时，`data/` 和 `uploads/` 目录会自动创建)
4.  **启动服务器**:
    * 打开您的终端或命令提示符。
    * 使用 `cd` 命令进入项目根目录 (例如 `cd path/to/notepad-app`)。
    * 运行以下命令启动服务器：
        ```bash
        node server.js
        ```
5.  **访问应用**:
    * 如果一切顺利，您会在终端看到类似 "服务器正在监听 http://localhost:3000/" 的消息。
    * 在您的浏览器中打开 `http://localhost:3000` 即可开始使用。
6.  **初始管理员账户**:
    * 首次启动时，如果 `data/users.json` 中不存在用户，系统会自动创建一个默认的管理员账户：
        * 用户名: `admin`
        * 密码: `admin` (此密码在首次保存到 `users.json` 时会被加密)

## 用户与权限

* **管理员 (`admin`)**:
    * 可以创建普通用户和管理员用户。
    * 可以删除任何用户（除了自己，且不能删除最后一个管理员）。
    * 可以重设任何用户的密码。
    * 可以查看所有用户的记事。
    * 可以通过创建或删除名为 `anyone` (角色 `anonymous`) 的用户来控制是否启用匿名只读访问。
* **普通用户 (`user`)**:
    * 可以注册账户。
    * 可以登录、登出。
    * 可以修改自己的密码。
    * 只能创建、查看、编辑、删除自己的记事。
* **匿名用户 (`anyone` / 访客)**:
    * 如果管理员创建了名为 `anyone` 且角色为 `anonymous` 的用户，则未登录的访客可以浏览所有用户的记事列表和记事详情。
    * 匿名用户不能进行任何写操作（如创建、编辑、删除记事或用户，修改密码等）。
    * 匿名用户可以下载附件。

请享受使用这个纯Node.js构建的记事本应用！
